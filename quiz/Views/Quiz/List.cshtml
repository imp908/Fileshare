
@{
    ViewBag.Title = "QuizList";
    Layout = "~/Views/Shared/_Layout_JsonAngularDriver.cshtml";
}
@model IEnumerable<Intranet.Models.QuizModel.Quiz>

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Список опросов</title>
    <script src="~/Scripts/CustomScripts/QuizJsonEditorForm/BootstrapModeules/bootstrap-dialog.min.js"></script>
    <link href="~/Scripts/CustomScripts/QuizJsonEditorForm/BootstrapModeules/bootstrap-dialog.min.css" rel="stylesheet" />
    <script>
        $(document).ready(function () {
            $('#quizes').DataTable(
            );
        });

        function toArchive(a, b) {
            BootstrapDialog.confirm('Уверены, что хотите перенести в Архив опрос <<' + b + '>>?', function (result) {
                if (result) {
                    //    alert(b);
                    $.ajax
                        ({
                            url: 'Quiz/List',
                            type: "post",
                            data: { 'RID': a },
                            cache: false,
                            success: function (savingStatus) { location.reload() },
                            error: function (xhr, ajaxOptions, thrownError) { }
                        });
                } else {

                }
            });
        }
    </script>
</head>
<body>
    
    <div class="col-md-8 col-md-offset-2">
        <br>
        <a href="/Quiz/Constructor" class="btn btn-info" role="button">Создать новый</a>&nbsp;&nbsp;&nbsp;<a href="/Quiz/Archive" class="btn btn-warning" role="button">Архив</a>
        <br>
        <br>
        <table id="quizes" class="table table-striped table-bordered dataTable">
            <thead>
                <tr>
                    <th><p>Название опроса</p></th>
                    <th><p>Автор</p></th>
                    <th><p>Дата создания</p></th>
                    <th><p>Дата начала</p></th>
                    <th><p>Дата завершения</p></th>
                    <th><p>Статус</p></th>
                    <th><p></p></th>

                </tr>
            </thead>
            <tbody>
            @foreach (var b in Model)
            {
                <tr>
                    <td><p><a href="/Quiz/Execute/?id=@b.QuizMainInfo.ORID.RID.Replace("#","")">@b.QuizMainInfo.QuizName</a></p></td>
                    <td><p>@b.QuizMainInfo.Author</p></td>
                    <td><p>@b.QuizMainInfo.CreationDate.ToString("dd.MM.yyyy")</p></td> 
                    <td><p>@b.QuizMainInfo.StartDate.ToString("dd.MM.yyyy")</p></td>
                    <td><p>@b.QuizMainInfo.EndDate.ToString("dd.MM.yyyy")</p></td>

                        @if (@b.QuizMainInfo.State == Intranet.Models.QuizModel.State.Drafted)
                        {
                            <td><p><a href="/Quiz/Constructor/?id=@b.QuizMainInfo.ORID.RID.Replace("#","")">Черновик</a></p></td>
                        }
                        @if (@b.QuizMainInfo.State == Intranet.Models.QuizModel.State.Finished)
                        {
                            <td><p><a href="/Quiz/Execute/?id=@b.QuizMainInfo.ORID.RID.Replace("#","")">Завершен</a></p></td>
                        }
                        @if (@b.QuizMainInfo.State == Intranet.Models.QuizModel.State.Published)
                        {
                            <td><p><a href="/Quiz/Results/?id=@b.QuizMainInfo.ORID.RID.Replace("#","")">Результаты</a></p></td> 
                        }
                    <td align="center"><button type="button" class="btn btn-success" title="В Архив!" onclick="toArchive('@b.QuizMainInfo.ORID.RID','@b.QuizMainInfo.QuizName')"><span class="glyphicon glyphicon-trash"></span></button></td>
                </tr>
              
            }
                 </tbody>
        </table>
    </div>


</body>
</html>